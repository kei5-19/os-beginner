# 19日目

<!-- mtoc-start -->

- [1. アプリのロードと実行](#1-アプリのロードと実行)

<!-- mtoc-end -->

## 1. アプリのロードと実行

仮想アドレスは `63:48`, `47:39`, `38:30`, `29:21`, `20:12`, `11:0` の6箇所に分割して解釈するらしい。
`PML` の先頭アドレスが `CR3` によって決定され、
`47:12` は9ビットずつに分割し、それぞれ `PML`, `PDP`, `PD`, `PT` のオフセットとして使われる。
最終的に `PT` から得られたアドレスに残りの最初12ビットを足して物理アドレスを得る。
上位16ビットは全部 `0` か全部 `1` でないと CPU 例外が発生するらしい。
で、この条件を満たすアドレスをカノニカルアドレスと呼ぶらしい。
この条件を満たしてないとこは使えないらしい。

でまあ普通は後半に OS を置いて前にユーザーアプリケーションを置くっぽい。
mikan OS では作りやすさのために前半に OS を置くらしいです。

使用した後のページングの削除も実装。
実際使えなくなっているかを gdb で確認したが、使えなくなっていそう。

これでシステムコール使わんアプリなら動くようになったし、だいぶ嬉しい。
（システムコール使わんアプリはそんなにない）
