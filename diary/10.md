# 10日目

## 1. もっとマウス

### 1.1 その前に修正

`Vector2D<u32>` で持っていた位置などを全て `Vector2D<i32>` に
変更した。
今まで位置に `Vector2D<u32>` を使ってきたが、冷静に変位を足したりするなら
`Vector2D<i32>` にしたほうが良いなと思い、`Vector2D<i32>` に変更した。
変数のサイズが同じなので基本的に上手く行っていたが、
上の方の枠外にマウスが飛び出したときに落ちていたのは、
多分オーバーフローだったんですね。

あと、`Vector<T>` の `x()`, `y()` メソッドだけが `Copy` トレイトを要求するように
修正した。

あとは教科書通りにしたが、前回のところで、`layermaneger.draw()` を入れ忘れていたっぽく、
マウスの移動が表示されない問題が起こった。
ただ、割り込みハンドラで `printk!()` を呼ぶと動いたので、気づけた。
前回は最後に計測時間を表示していたおかげで、 `draw()` を呼んでなかったのに
正常に動いていたみたい。

## 2. はじめてのウィンドウ

特に言う事無し。
ウィンドウが出るのは嬉しいか。

## 3. 高速カウンタ

最初 `hlt` なくし忘れていて、「？」になっていた。
正確に言うと、なくし忘れたというより、無くさんくていいんかな～と思ったけど、
書いてなかったしいいかと思ったら、見逃していた。

## 4. チラチラ解消

オーバーロード使うな！
Rust くん、オーバーロードとデフォルト引数と可変長引数導入してくれん？
いやまあ、型推論ができなくなるっていうのはもちろん分かるんで、
どっちがいいか問題なんですが……。
少なくとも可変長のためにマクロ書かされるのは嬉しくないやろ。
まあ `Iterator` で渡せばいいだけとか言われたらその通りかもしれません。

ところで、恐らく教科書（というかその github の）`Window::DrawTo()` はミスっていて、
透明色が設定されている場合、今まで通りの `pos`, `Width()`, `Height()` で考えてしまっていますが、
`intersection.pos` と `intersection.size` で考えないといけないと思います。

ここまでやってもまだ完全にはきれいに描画されないのか……。
OS、すごいぜ。

## 5. バックバッファ

おお～ってなりました。
ただ、なんかウィンドウの左上のほうだけマウスが一部消えるんやけど、なんでや？

## 6. ウィンドウのドラッグ移動

なんか位置から最上位のレイヤーを取得する関数を作ったが、ウィンドウサイズが必要なせいで、
全く変更をしないのに、`&mut self` を要求されて微妙な気持ちになっている。
（今まではウィンドウにアクセスが必要なのは描画など、変更が必要な場合だけ？だった）

まあでも要らんとこでも `&mut Window` で借用しとるとこあったし、共有参照返すやつ作って、
ついでにそういうとこでは共有参照返すようにした。

あとなんか、github を見たらしれっと `Console` に `bgwindow` ではなく新しくコンソール用のウィンドウを作って
それを使うように変更していた。
何も言わずにしれっと変更するのやめて欲しいな～。

## 7. ウィンドウだけドラッグ移動

まあここは特に言うこと無いな。
そのまま。

久しぶりに github copilot 有効にしたけど、途中まで合っとるとき、
途中まで補完利かす方法ないんかな？
