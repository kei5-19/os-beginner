# 23日目

<!-- mtoc-start -->

- [1. マウス入力](#1-マウス入力)
- [2. お絵描きソフト](#2-お絵描きソフト)
- [3. タイマコマンド](#3-タイマコマンド)
  - [3.1 描画時の範囲外アクセスを抑制](#31-描画時の範囲外アクセスを抑制)
  - [3.2 お絵かきソフトの修正](#32-お絵かきソフトの修正)
- [4. アニメーション](#4-アニメーション)
- [5. ブロック崩しゲーム](#5-ブロック崩しゲーム)

<!-- mtoc-end -->

## 1. マウス入力

特になし。

## 2. お絵描きソフト

なんか挙動変なときがあるから `LAYER_MANAGER` のロックを取れてないときがあるからかなと思って、
ロック取れるまで待つように実装してみた（デッドロックが起きるだろうと思った）けど、
そうはならないので、そういう問題ではないらしい。
まあ必要最低限はできたしええか。

## 3. タイマコマンド

### 3.1 描画時の範囲外アクセスを抑制

変なタイミングやけど、`panic` が起きすぎやから、描画関係でちゃんと範囲内か確認するようにした。
多分 `RgbResv8BitPerColorPixelWriter` とかは範囲内アクセスかどうかチェックされんからそのままでも動くけど、
変なメモリ書き換えられ得るからついでに同じように修正した。

### 3.2 お絵かきソフトの修正

多分やけど、範囲外でクリック外したときとかにイベントが発生せんくて変な挙動したりすると思ったから、
クリックされたときはそこを塗って、
そうじゃないときは毎度クリックされているか確認して描画するようにした。
そしたら、[2. お絵描きソフト](#2-お絵描きソフト) で書いた問題はなくなった。

## 4. アニメーション

なんかところどころミスしまくってクソ時間かかって悲しい。
途中まではちゃんと読んで理解したけど（ただ x, y, z 軸周りに回転させているだけ）、
途中からはコピペしただけ。
暇なときにちゃんと読みます。

あと、C++ と Rust でスタックの使う量が違うからやろうけど、
こっちではスタックオーバーフローが起きた。
対策としては、ページフォルトが起きたときにスタックを割り当てるという方法もあるけど、
それは教科書の後の方でやるっぽいから、とりあえず 4 KB から 8 KB に増やした。

## 5. ブロック崩しゲーム

また大量にミスりそうでやりたくないけど、今回は新しいイベントを追加するのでやる。

今回は1箇所しかミスらんかったし、ちゃんと最後まで理解した。
1箇所は `ball_y` と `ball_y_` （移動前後）を間違えてました。
まあ去年の OS の講義で同じようなの自分で書いたしな。
