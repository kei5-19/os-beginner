# 2日目

## EDK II でハローワールド（していない）

EDK II という、UEFI アプリケーション用の開発ツールがあり、第2章ではその使い方が説明されている。
しかし、現状は C 以外（少なくとも Rust） ではそのまま使えない。
その代わりに [r-efi](https://crates.io/crates/r-efi) crate で、
EDK で使われるヘッダファイルのようなものが恐らく定義されている。

なので、現状そこまで（そもそも簡単に導入できなさそうなものを頑張って入れる）必要性を感じない。
ということで、一旦このフェーズはパスすることにする。

ただ、メインの記述中に `unsafe` が現れるのは余り気分が良くないので、
土日とかの時間が取れるところで、別のモジュールとして切り出しを行いたい。

## メモリマップの取得

予想通り、[r-efi](https://crates.io/crates/r-efi) に必要なものは全部定義されていそうで、
生ポインタ等を使えば実装できた。

## メモリマップの保存

まずい。

一応途中までは書けたが、実際にデータをファイルに出力する際の文字の整形をどうするか問題で一旦止まった。
眠いので、一旦ここで終わる。

`unsafe` 多すぎるし、どこかで時間を取って綺麗にしたいが、
それよりも諦めて [uefi-rs](https://docs.rs/uefi/0.26.0/uefi/) を使うべきか……。

## uefi-rs による書き換え

**諦めた！**

思ったより手に負えなくなったので、[uefi-rs](https://docs.rs/uefi/0.26.0/uefi/) に乗り換えた。
生ポインタを使わずに済むし、何を書くのもクソ楽になった。

## メモリマップの取得と保存

[EDK II](https://github.com/tianocore/edk2) や [r-efi](https://crates.io/crates/r-efi) では
戻り値が `Status` で固定だったため、更新したい変数はポインタで渡していたが、
[uefi-rs](https://docs.rs/uefi/0.26.0/uefi/) ではそのまま戻り値で返ってくる。

そのため少し教科書とは違うように書かなければいけなかったが、ほとんど同じように書けた。
（まあ、同じ機能を探してくるのに時間がかかったが……）
